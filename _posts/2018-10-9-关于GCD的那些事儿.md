---
layout: post
title: "关于GCD的那些事儿"
author: "骆小喵"
categories: learning
tags: [learning]
feature-img: "assets/img/article/gcd.jpeg"
thumbnail: "assets/img/article/gcd.jpeg"
---

### 1. 前言
在说GCD之前我们先来想这么一个问题，假如我们项目的首页有五个模块，每个模块是一个接口，首页需要五个请求都完成之后组合数据并刷新页面，那么我们会怎么做呢？这个需求在我们平时开发中很常见，也时常会遇到，面试中更是会被问，那么怎么能够更好的处理这种需求呢？

### 2. 什么是Dispatch Queue
Dispatch Queue就是执行处理的等待队列。程序猿们通过```dispatch_async```等一些函数API在Block中写一些自己想执行的代码，并追加的Dispatch Queue中。然后Dispatch Queue按照追加的顺序（学术用语先进先出FIFO）执行处理。  


执行处理时存在两种Dispatch Queue，一种是串行队列Serial Dispatch Queue，一种是并行队列Concurrent Dispatch Queue。

### 3. 如何得到一个Dispatch Queue
得到Dispatch Queue有两种方法，一种是通过GCD的API生成，另一种是获取系统标准提供的Dispatch Queue。
#### 3.1 通过GCD的API生成
通过``` dispatch_queue_create ```函数可生成Dispatch Queue。
* 生成一个Serial Dispatch串行队列
```
dispatch_queue_t mySerialDispatchQueue = dispatch_queue_create("cc.omiao.gcd.mySerialDispacthQueue", NULL);
```
该函数的第一个参数指定串行队列的名称，例如上面的例子，Dispatch Queue的名称推荐使用应用程序的ID这种逆序全程域名，这样命名简单易懂，方便调试，当然你也可以设为NULL，不过调试的一脸懵逼，就会后悔为啥没有起一个好名字，哈哈哈哈。第二个参数指定为NULL,当然你也可以设DISPATCH_QUEUE_SERIAL不过没什么意义，本身DISPATCH_QUEUE_SERIAL就是NULL，不信看API啊。

* 生成一个Concurrent Dispatch Queue 并行队列
```
 dispatch_queue_t myConcurrentDispatchQueue = dispatch_queue_create("cc.omiao.gcd.myConcurrentDispatchQueue", DISPATCH_QUEUE_CONCURRENT);
```
生成并行队列的时候第一个参数同上，第二个参数必须写DISPATCH_QUEUE_CONCURRENT。

#### 3.2 获取系统标准提供的Dispatch Queue
实际上呢，也不用特意去生成Dispatch Queue，系统会给我们提供几个，比如Main Dispatch Queue和Global Dispatch Queue。


Main Dispatch Queue是在主线程执行的队列，因为主线程只有1个，所以Main Dispatch Queue是Serial Dispatch Queue串行队列。


而Global Dispatch Queue是所有应用程序都能使用的Concurrent Dispatch Queue，一般没必要通过函数```dispatch_queue_create```逐个生成Concurrent Dispatch Queue。只要获取一下系统提供的Global Dispatch Queue使用即可。另外呢Global 待续。。。。。。。。。。。。。。。。。。。。。。。。。。。。。。。。。。。

系统提供的Dispatch Queue总结如下表所示。


|名称|种类|说明|
|:-----|:-------|:-----|
|Main Dispatch Queue | Serial Dispatch Queue|主线程执行|
|Global Dispatch Queue(High Priority) | Concurrent Dispatch queue|执行优先级：高（最高优先）|
|Global Dispatch Queue(Default Priority) | Concurrent Dispatch queue|执行优先级：默认 |
|Global Dispatch Queue(Low Priority) | Concurrent Dispatch queue|执行优先级：低 |
|Global Dispatch Queue(Background Priority) | Concurrent Dispatch queue|执行优先级：后台 |


各种Dispatch Queue 的获取方法如下。
```
/*
 *  Main Dispatch Queue 的获取方法
 */
dispatch_queue_t mainDispatchQueue = dispatch_get_main_queue();

/*
 *  Global Dispatch Queue (最高优先级)的获取方法
 */  
dispatch_queue_t globalDispatchQueueHigh = dispatch_get_global_queue(DISPATCH_QUEUE_PRIORITY_HIGH, 0);
    
/*
 *  Global Dispatch Queue (默认优先级)的获取方法 
 */
dispatch_queue_t globalDispatchQueueDefault = dispatch_get_global_queue(DISPATCH_QUEUE_PRIORITY_DEFAULT, 0);
    
/*
 *  Global Dispatch Queue (低优先级)的获取方法 
 */
dispatch_queue_t globalDispatchQueueLow = dispatch_get_global_queue(DISPATCH_QUEUE_PRIORITY_LOW, 0);
    
/*
 *  Global Dispatch Queue (后台优先级)的获取方法 
 */
dispatch_queue_t globalDispatchQueueBackground = dispatch_get_global_queue(DISPATCH_QUEUE_PRIORITY_BACKGROUND, 0);

```





